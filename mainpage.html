<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>BirdblogUN</title>
  </head>
  <body>

    <!-- To DO: Validate file type/size(?) -->
    <script src="https://www.gstatic.com/firebasejs/5.0.4/firebase.js"></script>

    <script type="module">
      // Import the functions you need from the SDKs you need
      import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.1/firebase-app.js";
      import { getAnalytics } from "https://www.gstatic.com/firebasejs/10.8.1/firebase-analytics.js";

      const config = {
        apiKey: "AIzaSyCx4P-M8e6M-njQQ8x5_HlHIZN2VNZtfNk",
        authDomain: "aves-a1081.firebaseapp.com",
        databaseURL: "https://aves-a1081-default-rtdb.firebaseio.com",
        projectId: "aves-a1081",
        storageBucket: "aves-a1081.appspot.com",
        messagingSenderId: "176518929787",
        appId: "1:176518929787:web:7b9a24b4bdd38f5f78b1de",
        measurementId: "G-PB7JDN6Z7S",
      };

      firebase.initializeApp(config);

      var selectedFile;
      function getfile() {
        var pic = document.getElementById("photo");
        // selected file is that file which user chosen by html form
        selectedFile = pic.files[0];
        // make save button disabled for few seconds that has id='submit_link'
        document.getElementById("submit_link").setAttribute("disabled", "true");
        myfunction(); // call below written function
      }

      function myfunction() {
        // select unique name for everytime when image uploaded
        // Date.now() is function that give current timestamp
        var name = "123" + Date.now();
        // make ref to your firebase storage and select images folder
        var storageRef = firebase.storage().ref("/images/" + name);
        // put file to firebase
        var uploadTask = storageRef.put(selectedFile);
        // all working for progress bar that in html
        // to indicate image uploading... report
        uploadTask.on(
          "state_changed",
          function (snapshot) {
            var progress =
              (snapshot.bytesTransferred / snapshot.totalBytes) * 100;
            var uploader = document.getElementById("uploader");
            uploader.value = progress;
            switch (snapshot.state) {
              case firebase.storage.TaskState.PAUSED:
                console.log("Upload is paused");
                break;
              case firebase.storage.TaskState.RUNNING:
                console.log("Upload is running");
                break;
            }
          },
          function (error) {
            console.log(error);
          },
          function () {
            // get the uploaded image url back
            uploadTask.snapshot.ref
              .getDownloadURL()
              .then(function (downloadURL) {
                // You get your url from here
                console.log("File available at", downloadURL);
                // print the image url
                console.log(downloadURL);
                document
                  .getElementById("submit_link")
                  .removeAttribute("disabled");
              });
          }
        );
      }

      document.getElementById("photo").addEventListener("change", function () {
        getfile();
      });
    </script>

    <!-- Formulario -->
    <form>
      <progress value="0" id="uploader" max="100">0%</progress><br /><br />
      <!-- get the file from user -->
      <input
        id="photo"
        class="file"
        type="file"
        name="mainimage"
        value=""
      /><br /><br />
      <!-- submit the chosen file -->
      <button id="submit_link" type="submit" name="button">Save</button>
    </form>
  </body>
</html>
